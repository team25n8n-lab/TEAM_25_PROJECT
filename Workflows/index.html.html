<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital management system</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
        .hidden { display: none !important; }
        .response-content { max-width: 100%; overflow-wrap: break-word; }
        .loading { opacity: 0.6; pointer-events: none; }
        
        /* Loading Spinner Styles */
        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #2563eb;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 0.8s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Success Alert Fade-in Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .success-alert {
            animation: fadeIn 0.5s ease-out;
        }

        /* ============================================ */
        /* PROFESSIONAL CHATBOT STYLES */
        /* ============================================ */
        
        /* Chat Widget Button */
        .chat-toggle-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0066cc 0%, #0099cc 100%);
            border: none;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(0, 102, 204, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chat-toggle-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 12px 40px rgba(0, 102, 204, 0.5);
        }
        
        .chat-toggle-btn::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0066cc 0%, #0099cc 100%);
            opacity: 0.3;
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse-ring {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.15); opacity: 0; }
        }
        
        /* Chat Window */
        .chat-window {
            position: fixed;
            bottom: 100px;
            right: 24px;
            width: 400px;
            max-width: calc(100vw - 48px);
            height: 600px;
            max-height: calc(100vh - 140px);
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 9998;
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        /* Chat Header */
        .chat-header {
            background: linear-gradient(135deg, #0066cc 0%, #0088cc 50%, #00a3cc 100%);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .chat-header::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M26 18h8v8h8v8h-8v8h-8v-8h-8v-8h8v-8z' fill='%23ffffff' fill-opacity='0.05'/%3E%3C/svg%3E");
            opacity: 0.5;
        }
        
        .chat-header-content {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chat-header-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .chat-avatar {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 16px;
        }
        
        .chat-header-text h3 {
            color: white;
            font-weight: 700;
            font-size: 16px;
            margin: 0;
        }
        
        .chat-status {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .status-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
        }
        
        .chat-close-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .chat-close-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .chat-close-btn svg {
            color: white;
            width: 20px;
            height: 20px;
        }
        
        /* Chat Messages Area */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
        }
        
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 3px;
        }
        
        /* Welcome Message */
        .welcome-message {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            animation: messageSlide 0.3s ease-out;
        }
        
        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .welcome-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0066cc, #00a3cc);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .welcome-bubble {
            background: white;
            padding: 14px 18px;
            border-radius: 18px;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            max-width: 85%;
        }
        
        .welcome-bubble p {
            color: #1f2937;
            font-size: 14px;
            line-height: 1.5;
            margin: 0;
        }
        
        /* Menu Tabs */
        .menu-tabs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            animation: messageSlide 0.3s ease-out 0.1s both;
        }
        
        .menu-tab {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        
        .menu-tab:hover {
            border-color: #0066cc;
            background: #f0f7ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.15);
        }
        
        .menu-tab:active {
            transform: translateY(0);
        }
        
        .menu-tab.full-width {
            grid-column: span 2;
            background: linear-gradient(135deg, #f0f7ff 0%, #e8f4ff 100%);
            border-color: #0066cc40;
        }
        
        .menu-tab-icon {
            font-size: 22px;
            flex-shrink: 0;
        }
        
        .menu-tab-content {
            min-width: 0;
        }
        
        .menu-tab-title {
            font-weight: 600;
            font-size: 13px;
            color: #1f2937;
            margin: 0;
        }
        
        .menu-tab-desc {
            font-size: 11px;
            color: #6b7280;
            margin: 2px 0 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Message Bubbles */
        .message-row {
            display: flex;
            margin-bottom: 12px;
            animation: messageSlide 0.3s ease-out;
        }
        
        .message-row.user {
            justify-content: flex-end;
        }
        
        .message-row.bot {
            justify-content: flex-start;
            gap: 10px;
        }
        
        .bot-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0066cc, #00a3cc);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .message-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .message-bubble.user {
            background: linear-gradient(135deg, #0066cc, #0088cc);
            color: white;
            border-bottom-right-radius: 6px;
        }
        
        .message-bubble.bot {
            background: white;
            color: #1f2937;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .message-bubble.bot strong {
            color: #0066cc;
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            animation: messageSlide 0.3s ease-out;
        }
        
        .typing-bubble {
            background: white;
            padding: 14px 18px;
            border-radius: 18px;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            display: flex;
            gap: 5px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #9ca3af;
            border-radius: 50%;
            animation: typingBounce 1.4s ease-in-out infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-6px); }
        }
        
        /* Follow-up Buttons */
        .followup-container {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            animation: messageSlide 0.3s ease-out;
        }
        
        .followup-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0066cc, #00a3cc);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .followup-bubble {
            background: white;
            padding: 14px 18px;
            border-radius: 18px;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .followup-bubble p {
            color: #1f2937;
            font-size: 14px;
            margin: 0 0 12px;
        }
        
        .followup-buttons {
            display: flex;
            gap: 10px;
        }
        
        .followup-btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        
        .followup-btn.yes {
            background: linear-gradient(135deg, #0066cc, #0088cc);
            color: white;
        }
        
        .followup-btn.yes:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
        }
        
        .followup-btn.no {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .followup-btn.no:hover {
            background: #e5e7eb;
        }
        
        /* Chat Input Area */
        .chat-input-area {
            padding: 16px 20px;
            background: white;
            border-top: 1px solid #e5e7eb;
        }
        
        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 18px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            font-size: 14px;
            outline: none;
            transition: all 0.2s;
        }
        
        .chat-input:focus {
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }
        
        .chat-input:disabled {
            background: #f9fafb;
            cursor: not-allowed;
        }
        
        .chat-send-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, #0066cc, #0088cc);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .chat-send-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
        }
        
        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .chat-send-btn svg {
            color: white;
            width: 20px;
            height: 20px;
        }
        
        /* Back to Menu Link */
        .back-to-menu {
            text-align: center;
            padding: 10px;
            border-top: 1px solid #e5e7eb;
            background: #f9fafb;
        }
        
        .back-to-menu button {
            background: none;
            border: none;
            color: #6b7280;
            font-size: 13px;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .back-to-menu button:hover {
            color: #0066cc;
        }
        
        /* Mobile Responsive */
        @media (max-width: 480px) {
            .chat-window {
                bottom: 0;
                right: 0;
                width: 100%;
                max-width: 100%;
                height: 100%;
                max-height: 100%;
                border-radius: 0;
            }
            
            .chat-toggle-btn {
                bottom: 16px;
                right: 16px;
                width: 56px;
                height: 56px;
            }
            
            .menu-tabs {
                grid-template-columns: 1fr;
            }
            
            .menu-tab.full-width {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-green-50">

<!-- Home Page -->
<div id="home-page" class="container mx-auto px-4 py-12">
    <header class="text-center mb-16">
        <h1 class="text-5xl font-bold text-gray-800 mb-4">Hospital management system</h1>
        <p class="text-xl text-gray-600">Streamlining healthcare workflows with intelligent automation</p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
        <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 overflow-hidden">
            <div class="bg-blue-500 p-6 text-white">
                <svg class="w-12 h-12 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                <h3 class="text-2xl font-bold mb-2">Automated Lab Result</h3>
            </div>
            <div class="p-6">
                <p class="text-gray-600 mb-6 min-h-[60px]">Automated processing and delivery of lab results to patients and doctors</p>
                <button onclick="showWorkflow('automated-lab-result')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200">Try Now</button>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 overflow-hidden">
            <div class="bg-green-500 p-6 text-white">
                <svg class="w-12 h-12 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                <h3 class="text-2xl font-bold mb-2">Symptoms Checker</h3>
            </div>
            <div class="p-6">
                <p class="text-gray-600 mb-6 min-h-[60px]">AI-powered symptom analysis and medical guidance</p>
                <button onclick="showWorkflow('symptoms-checker')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200">Try Now</button>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 overflow-hidden">
            <div class="bg-orange-500 p-6 text-white">
                <svg class="w-12 h-12 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
                <h3 class="text-2xl font-bold mb-2">Pharmacy Inventory</h3>
            </div>
            <div class="p-6">
                <p class="text-gray-600 mb-6 min-h-[60px]">Automated inventory tracking and expiry notifications</p>
                <button onclick="showWorkflow('pharmacy-inventory')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200">Try Now</button>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 overflow-hidden">
            <div class="bg-purple-500 p-6 text-white">
                <svg class="w-12 h-12 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                <h3 class="text-2xl font-bold mb-2">Medical Record OCR</h3>
            </div>
            <div class="p-6">
                <p class="text-gray-600 mb-6 min-h-[60px]">Intelligent OCR extraction from medical documents</p>
                <button onclick="showWorkflow('medical-record-ocr')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200">Try Now</button>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 overflow-hidden">
            <div class="bg-cyan-500 p-6 text-white">
                <svg class="w-12 h-12 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                <h3 class="text-2xl font-bold mb-2">Appointment Booking</h3>
            </div>
            <div class="p-6">
                <p class="text-gray-600 mb-6 min-h-[60px]">Smart appointment scheduling with automated reminders</p>
                <button onclick="showWorkflow('appointment-booking')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200">Try Now</button>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 overflow-hidden">
            <div class="bg-teal-500 p-6 text-white">
                <svg class="w-12 h-12 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                <h3 class="text-2xl font-bold mb-2">Patient Follow-Up</h3>
            </div>
            <div class="p-6">
                <p class="text-gray-600 mb-6 min-h-[60px]">Automated patient follow-up reminders and tracking</p>
                <button onclick="showWorkflow('patient-followup')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200">Try Now</button>
            </div>
        </div>
    </div>
</div>

<!-- Workflow Pages -->
<div id="workflow-container" class="hidden container mx-auto px-4 py-8">
    <button onclick="showHome()" class="flex items-center gap-2 text-blue-600 hover:text-blue-800 mb-8 font-semibold">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
        Back to Home
    </button>

    <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-xl p-8">
        <h2 id="workflow-title" class="text-3xl font-bold text-gray-800 mb-2"></h2>
        <p id="workflow-description" class="text-gray-600 mb-8"></p>
        <div id="workflow-content"></div>
        <div id="response-container" class="hidden mt-6 p-6 bg-green-50 border border-green-200 rounded-lg">
            <h3 class="text-lg font-semibold text-green-800 mb-3">Response</h3>
            <div id="response-content" class="text-gray-700 response-content"></div>
        </div>
        <div id="error-container" class="hidden mt-6 p-4 bg-red-50 border border-red-200 rounded-lg"></div>
    </div>
</div>

<!-- ============================================ -->
<!-- PROFESSIONAL HEALTHCARE CHATBOT -->
<!-- ============================================ -->

<!-- Chat Window -->
<div id="chatbot-window" class="chat-window hidden">
    <!-- Header -->
    <div class="chat-header">
        <div class="chat-header-content">
            <div class="chat-header-info">
                <div class="chat-avatar">SC</div>
                <div class="chat-header-text">
                    <h3>Hospital management system</h3>
                    <div class="chat-status">
                        <span class="status-dot" id="status-dot"></span>
                        <span class="status-text" id="status-text">Online 24/7</span>
                    </div>
                </div>
            </div>
            <button class="chat-close-btn" onclick="toggleChat()">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Chat Content -->
    <div id="chat-messages" class="chat-messages">
        <!-- Content will be injected by JavaScript -->
    </div>

    <!-- Input Area -->
    <div class="chat-input-area" id="chat-input-area">
        <div class="chat-input-wrapper">
            <input type="text" id="chat-input" class="chat-input" placeholder="Type your message..." 
                   onkeypress="if(event.key==='Enter') sendChatMessage()" disabled>
            <button id="chat-send-btn" class="chat-send-btn" onclick="sendChatMessage()" disabled>
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Back to Menu -->
    <div class="back-to-menu hidden" id="back-to-menu">
        <button onclick="showMenu()">‚Üê Back to Main Menu</button>
    </div>
</div>

<!-- Chat Toggle Button -->
<button class="chat-toggle-btn" onclick="toggleChat()" id="chat-toggle-btn">
    <svg width="28" height="28" fill="none" stroke="white" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
    </svg>
</button>

<script>
// ============================================
// üîß CONFIGURATION SECTION - EDIT YOUR WEBHOOK URLs HERE
// ============================================
const WORKFLOW_ENDPOINTS = {
    'automated-lab-result': 'https://newteam25.app.n8n.cloud/webhook/lab-result',
    'symptoms-checker': 'https://newteam25.app.n8n.cloud/webhook/symptoms-checker',
    'pharmacy-inventory': 'https://newteam25.app.n8n.cloud/webhook/inventroy-management',
    'medical-record-ocr': 'https://newteam25.app.n8n.cloud/webhook/ocr-upload',
    'appointment-booking': 'https://newteam25.app.n8n.cloud/webhook/request-appointments',
    'appointment-booking-confirm': 'https://newteam25.app.n8n.cloud/webhook/confirm-appointment',
    'patient-followup': 'https://newteam25.app.n8n.cloud/webhook/frontend-intake'
};

// Chatbot webhook URL
const CHATBOT_URL = 'https://newteam25.app.n8n.cloud/webhook/chatbot';
// ============================================
// END CONFIGURATION
// ============================================

// Doctor-Specialty Mapping
const DOCTOR_SPECIALTY_MAP = {
    'Cardiology': ['Dr. Ahmed', 'Dr. Ayesha'],
    'Neurology': ['Dr. Sara', 'Dr. Luca'],
    'Orthopedics': ['Dr. Hassan', 'Dr. Emil'],
    'Pediatrics': ['Dr. Noor', 'Dr. Youssef'],
    'Dermatology': ['Dr. Karim', 'Dr. Amina'],
    'Psychiatry': ['Dr. Farah', 'Dr. Ibrahim'],
    'Ophthalmology': ['Dr. Salim', 'Dr. Nadia'],
    'Gastroenterology': ['Dr. Omar Farooq', 'Dr. Hana']
};

let currentWorkflow = null;
let formData = {};
let availableSlots = [];
let selectedSlot = null;

// Chatbot State
let chatMode = 'menu'; // 'menu', 'loading', 'response', 'live-chat', 'closed'
let sessionId = 'session-' + Date.now();

const BLUEPRINTS = {
    'automated-lab-result': {
        name: 'Automated Lab Result',
        description: 'Automated processing and delivery of lab results to patients and doctors',
        fields: [
            {name: 'patient_name', type: 'text', required: true, label: 'Patient Name'},
            {name: 'patient_id', type: 'text', required: true, label: 'Patient ID'},
            {name: 'patient_email', type: 'email', required: true, label: 'Patient Email'},
            {name: 'patient_doctor_email', type: 'email', required: true, label: 'Doctor Email'},
            {name: 'file_url', type: 'file', required: true, label: 'Lab Report PDF', accept: 'application/pdf'},
            {name: 'file_name', type: 'text', required: true, label: 'File Name'}
        ]
    },
    'symptoms-checker': {
        name: 'Symptoms Checker',
        description: 'AI-powered symptom analysis and medical guidance',
        fields: [
            {name: 'name', type: 'text', required: true, label: 'Full Name'},
            {name: 'email', type: 'email', required: true, label: 'Email Address'},
            {name: 'age', type: 'number', required: true, label: 'Age'},
            {name: 'gender', type: 'select', required: true, label: 'Gender', options: ['Male', 'Female', 'Other']},
            {name: 'symptoms', type: 'textarea', required: true, label: 'Describe Your Symptoms'},
            {name: 'duration', type: 'text', required: true, label: 'How Long Have You Had These Symptoms?'},
            {name: 'existing_medicines', type: 'textarea', required: false, label: 'Current Medications (if any)'}
        ]
    },
    'pharmacy-inventory': {
        name: 'Pharmacy Inventory Management & Expiry Alerts',
        description: 'Automated inventory tracking and expiry notifications',
        special: 'check-only'
    },
    'medical-record-ocr': {
        name: 'Medical Record OCR Automation',
        description: 'Intelligent OCR extraction from medical documents',
        fields: [
            {name: 'file', type: 'file', required: true, label: 'Medical Record Document', accept: 'application/pdf,image/*'}
        ]
    },
    'appointment-booking': {
        name: 'Appointment Booking',
        description: 'Smart appointment scheduling with automated reminders',
        fields: [
            {name: 'specialty', type: 'select', required: true, label: 'Specialty', options: ['Cardiology', 'Neurology', 'Orthopedics', 'Pediatrics', 'Dermatology', 'Psychiatry', 'Ophthalmology', 'Gastroenterology']},
            {name: 'doctor', type: 'select', required: true, label: 'Doctor', options: [], disabled: true},
            {name: 'date', type: 'date', required: true, label: 'Preferred Date'}
        ],
        confirmFields: [
            {name: 'patient_name', type: 'text', required: true, label: 'Patient Name'},
            {name: 'email', type: 'email', required: true, label: 'Email'},
            {name: 'phone', type: 'tel', required: true, label: 'Phone Number'}
        ]
    },
    'patient-followup': {
        name: 'Appointment Follow-Up Form',
        description: 'Collect patient details and send them to the clinic for follow-up',
        fields: [
            { name: 'fullName', type: 'text', required: true, label: 'Full Name' },
            { name: 'phone', type: 'tel', required: true, label: 'Phone Number' },
            { name: 'email', type: 'email', required: true, label: 'Email Address' },
            { name: 'specialty', type: 'text', required: true, label: 'Specialty' },
            { name: 'doctor', type: 'text', required: true, label: 'Doctor Name' },
            { name: 'preferredDate', type: 'date', required: true, label: 'Preferred Date' }
        ]
    }
};

// ============================================
// WEBSITE WORKFLOW FUNCTIONS (UNCHANGED)
// ============================================

function showHome() {
    document.getElementById('home-page').classList.remove('hidden');
    document.getElementById('workflow-container').classList.add('hidden');
    currentWorkflow = null;
    formData = {};
    availableSlots = [];
    selectedSlot = null;
}

function showWorkflow(workflowId) {
    currentWorkflow = workflowId;
    const blueprint = BLUEPRINTS[workflowId];
    
    document.getElementById('home-page').classList.add('hidden');
    document.getElementById('workflow-container').classList.remove('hidden');
    document.getElementById('workflow-title').textContent = blueprint.name;
    document.getElementById('workflow-description').textContent = blueprint.description;
    document.getElementById('response-container').classList.add('hidden');
    document.getElementById('error-container').classList.add('hidden');
    
    if (blueprint.special === 'check-only') {
        renderCheckOnly();
    } else {
        renderForm(blueprint);
    }
}

function renderCheckOnly() {
    document.getElementById('workflow-content').innerHTML = `
        <div class="text-center">
            <button id="check-inventory-btn" onclick="handleCheckInventory()" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-8 rounded-lg text-lg">
                Check Inventory
            </button>
        </div>
    `;
}

function renderForm(blueprint) {
    const container = document.getElementById('workflow-content');
    let html = '<div class="space-y-6">';
    
    blueprint.fields.forEach(field => {
        html += `<div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
                ${field.label} ${field.required ? '<span class="text-red-500">*</span>' : ''}
            </label>`;
        
        if (field.type === 'textarea') {
            html += `<textarea id="${field.name}" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>`;
        } else if (field.type === 'file') {
            html += `<input type="file" id="${field.name}" accept="${field.accept || ''}" class="w-full px-4 py-2 border border-gray-300 rounded-lg" onchange="handleFileChange('${field.name}', this.files[0])">`;
        } else if (field.type === 'select') {
            const onchange = field.name === 'specialty' ? 'onchange="updateDoctorOptions()"' : '';
            html += `<select id="${field.name}" ${field.disabled ? 'disabled' : ''} ${onchange} class="w-full px-4 py-2 border border-gray-300 rounded-lg ${field.disabled ? 'bg-gray-100 cursor-not-allowed' : ''}">
                <option value="">Select ${field.label}</option>`;
            if (field.options) {
                field.options.forEach(opt => {
                    html += `<option value="${opt}">${opt}</option>`;
                });
            }
            html += '</select>';
        } else {
            html += `<input type="${field.type}" id="${field.name}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">`;
        }
        
        html += '</div>';
    });
    
    html += `<button id="submit-btn" onclick="handleSubmit()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200">Submit</button>`;
    html += '</div>';
    
    container.innerHTML = html;
}

function updateDoctorOptions() {
    const specialty = document.getElementById('specialty').value;
    const doctorSelect = document.getElementById('doctor');
    
    doctorSelect.innerHTML = '<option value="">Select Doctor</option>';
    
    if (specialty && DOCTOR_SPECIALTY_MAP[specialty]) {
        DOCTOR_SPECIALTY_MAP[specialty].forEach(doc => {
            doctorSelect.innerHTML += `<option value="${doc}">${doc}</option>`;
        });
        doctorSelect.disabled = false;
        doctorSelect.classList.remove('bg-gray-100', 'cursor-not-allowed');
    } else {
        doctorSelect.disabled = true;
        doctorSelect.classList.add('bg-gray-100', 'cursor-not-allowed');
    }
}

function handleFileChange(fieldName, file) {
    if (!file) return;
    
    const reader = new FileReader();
    reader.onloadend = function() {
        formData[fieldName] = reader.result;
        if (currentWorkflow === 'medical-record-ocr') {
            formData['file_name'] = file.name;
        }
        if (currentWorkflow === 'automated-lab-result') {
            formData['file_url'] = reader.result;
            formData['file_name'] = file.name;
        }
    };
    reader.readAsDataURL(file);
}

function collectFormData() {
    const blueprint = BLUEPRINTS[currentWorkflow];
    const existingFileData = {};
    blueprint.fields.forEach(field => {
        if (field.type === 'file' && formData[field.name]) {
            existingFileData[field.name] = formData[field.name];
        }
    });
    
    formData = {};
    blueprint.fields.forEach(field => {
        if (field.type !== 'file') {
            const el = document.getElementById(field.name);
            if (el) formData[field.name] = el.value;
        }
    });
    
    Object.keys(existingFileData).forEach(key => {
        formData[key] = existingFileData[key];
    });
    
    return formData;
}

function validateForm() {
    const blueprint = BLUEPRINTS[currentWorkflow];
    for (const field of blueprint.fields) {
        if (field.required && !formData[field.name]) {
            alert(`Please fill in: ${field.label}`);
            return false;
        }
    }
    return true;
}

function setButtonLoading(buttonId, isLoading) {
    const button = document.getElementById(buttonId);
    if (!button) return;
    
    if (isLoading) {
        button.disabled = true;
        button.classList.add('opacity-60', 'cursor-not-allowed');
        const originalText = button.innerHTML;
        button.setAttribute('data-original-text', originalText);
        button.innerHTML = '<span class="spinner"></span>Processing...';
    } else {
        button.disabled = false;
        button.classList.remove('opacity-60', 'cursor-not-allowed');
        const originalText = button.getAttribute('data-original-text');
        if (originalText) button.innerHTML = originalText;
    }
}

async function handleSubmit() {
    collectFormData();
    if (!validateForm()) return;
    
    setButtonLoading('submit-btn', true);
    hideMessages();
    
    try {
        let response;
        if (currentWorkflow === 'medical-record-ocr' || currentWorkflow === 'automated-lab-result') {
            const formDataObj = new FormData();
            const blueprint = BLUEPRINTS[currentWorkflow];
            blueprint.fields.forEach(field => {
                const element = document.getElementById(field.name);
                if (field.type === 'file' && element && element.files && element.files[0]) {
                    formDataObj.append(field.name, element.files[0]);
                } else if (element) {
                    formDataObj.append(field.name, element.value);
                }
            });
            response = await fetch(WORKFLOW_ENDPOINTS[currentWorkflow], {
                method: 'POST',
                body: formDataObj
            });
        } else {
            response = await fetch(WORKFLOW_ENDPOINTS[currentWorkflow], {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(formData)
            });
        }
        
        const data = await response.json();
        if (currentWorkflow === 'appointment-booking' && data.available_slots) {
            availableSlots = data.available_slots;
            renderAppointmentSlots();
        } else {
            showResponse(data);
        }
    } catch (error) {
        showError(error.message);
    } finally {
        setButtonLoading('submit-btn', false);
    }
}

async function handleCheckInventory() {
    setButtonLoading('check-inventory-btn', true);
    hideMessages();
    
    try {
        const response = await fetch(WORKFLOW_ENDPOINTS[currentWorkflow], {
            method: 'POST',
            headers: {'Content-Type': 'application/json'}
        });
        const data = await response.json();
        showResponse(data);
    } catch (error) {
        showError(error.message);
    } finally {
        setButtonLoading('check-inventory-btn', false);
    }
}

function renderAppointmentSlots() {
    const container = document.getElementById('workflow-content');
    let html = `
        <div class="bg-white shadow-lg rounded-xl p-8 space-y-8">
            <h3 class="text-2xl font-bold text-blue-700 mb-4">Available Time Slots</h3>
            <div class="grid gap-4 max-h-64 overflow-y-auto">
                ${availableSlots.map((slot, index) => `
                    <div onclick="selectSlot(${index})" id="slot-${index}" class="border rounded-lg p-5 cursor-pointer transition hover:shadow-md hover:border-blue-400">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-semibold text-lg">${slot.doctor_name}</p>
                                <p class="text-sm text-gray-500">${slot.specialty || ''}</p>
                                <p class="text-sm text-gray-600">${slot.date} | ${slot.start_time} - ${slot.end_time}</p>
                            </div>
                            <div id="selected-icon-${index}" class="hidden text-blue-600">‚úÖ</div>
                        </div>
                    </div>
                `).join('')}
            </div>
            <h3 class="text-2xl font-bold text-blue-700 mb-4">Enter Your Details</h3>
            <div class="space-y-5">
                <div><label class="block text-sm font-medium text-gray-700 mb-2">Patient Name *</label><input type="text" id="confirm-patient_name" placeholder="Enter your full name" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500"></div>
                <div><label class="block text-sm font-medium text-gray-700 mb-2">Email *</label><input type="email" id="confirm-email" placeholder="example@email.com" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500"></div>
                <div><label class="block text-sm font-medium text-gray-700 mb-2">Phone Number *</label><input type="tel" id="confirm-phone" placeholder="+966 5XXXXXXXX" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500"></div>
            </div>
            <button id="confirm-appointment-btn" onclick="confirmAppointment()" class="w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-bold py-4 px-6 rounded-xl shadow-md transition">Confirm Appointment</button>
        </div>
    `;
    container.innerHTML = html;
}

function selectSlot(index) {
    selectedSlot = availableSlots[index];
    availableSlots.forEach((slot, i) => {
        const card = document.getElementById(`slot-${i}`);
        const icon = document.getElementById(`selected-icon-${i}`);
        if (card) card.className = "border rounded-lg p-5 cursor-pointer transition hover:shadow-md hover:border-blue-400";
        if (icon) icon.classList.add("hidden");
    });
    const selectedCard = document.getElementById(`slot-${index}`);
    const selectedIcon = document.getElementById(`selected-icon-${index}`);
    if (selectedCard) selectedCard.className = "border-2 border-blue-600 rounded-lg p-5 bg-blue-50 shadow-md";
    if (selectedIcon) selectedIcon.classList.remove("hidden");
}

async function confirmAppointment() {
    if (!selectedSlot) { alert('Please select a time slot'); return; }
    
    const appointmentData = {
        patient_name: document.getElementById('confirm-patient_name').value,
        email: document.getElementById('confirm-email').value,
        phone: document.getElementById('confirm-phone').value,
        doctor: selectedSlot.doctor_name,
        doctor_id: selectedSlot.doctor_id,
        date: selectedSlot.date,
        appointment_time: `${selectedSlot.start_time} - ${selectedSlot.end_time}`
    };
    
    if (!appointmentData.patient_name || !appointmentData.email || !appointmentData.phone) {
        alert('Please fill in all required fields'); return;
    }
    
    setButtonLoading('confirm-appointment-btn', true);
    hideMessages();
    
    try {
        const response = await fetch(WORKFLOW_ENDPOINTS['appointment-booking-confirm'], {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(appointmentData)
        });
        const data = await response.json();
        showResponse(data);
        availableSlots = [];
        selectedSlot = null;
        renderForm(BLUEPRINTS[currentWorkflow]);
    } catch (error) {
        showError(error.message);
    } finally {
        setButtonLoading('confirm-appointment-btn', false);
    }
}

function showResponse(response) {
    const container = document.getElementById('response-container');
    const content = document.getElementById('response-content');
    
    // Check if status is "received" and show success alert
    if (response.status === "received" && response.message) {
        content.innerHTML = `
            <div class="success-alert flex items-start gap-3 p-5 bg-green-100 border-2 border-green-400 rounded-xl shadow-md">
                <svg class="w-7 h-7 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                    <h4 class="text-xl font-bold text-green-800 mb-1">Success!</h4>
                    <p class="text-green-700 text-base">${response.message}</p>
                </div>
            </div>
        `;
        container.classList.remove('hidden');
        return;
    }
    
    // Special case: appointment confirmations
    if (currentWorkflow === 'appointment-booking' || currentWorkflow === 'appointment-booking-confirm') {
        const r = response.result || response;
        content.innerHTML = `
            <div class="p-6 border rounded-xl bg-green-50 shadow">
                <h3 class="text-2xl font-bold text-green-800 mb-4">Appointment Confirmed ‚úÖ</h3>
                <p class="mb-2"><strong>Patient:</strong> ${r.patient_name || '-'}</p>
                <p class="mb-2"><strong>Doctor:</strong> ${r.doctor || '-'}</p>
                <p class="mb-2"><strong>Date:</strong> ${r.date || '-'}</p>
                <p class="mb-2"><strong>Time:</strong> ${r.time || r.appointment_time || '-'}</p>
                <p class="mt-4 text-green-700">A confirmation email will be sent to: ${r.email || '-'}</p>
            </div>
        `;
    }
    // Medical Record OCR - handle workflow start message
    else if (currentWorkflow === 'medical-record-ocr') {
        if (response.message) {
            content.innerHTML = `
                <div class="success-alert p-6 bg-blue-50 border-2 border-blue-400 rounded-xl">
                    <div class="flex items-center gap-3 mb-4">
                        <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h4 class="text-xl font-bold text-blue-800">OCR Processing Started</h4>
                    </div>
                    <div class="bg-white p-4 rounded-lg text-gray-800">
                        <p class="leading-relaxed">${response.message}</p>
                        <p class="text-sm text-gray-600 mt-3">üìß The extracted data will be processed and sent to the relevant parties.</p>
                    </div>
                </div>
            `;
        } else {
            // Try to extract text from various possible response structures
            let extractedText = response.extracted_data || response.text || response.ocr_text || response.data || response.result;
            
            // If it's still an object, try to get any text-like property
            if (typeof extractedText === 'object' && extractedText !== null) {
                extractedText = extractedText.text || extractedText.content || JSON.stringify(extractedText, null, 2);
            }
            
            content.innerHTML = `
                <div class="success-alert p-6 bg-blue-50 border-2 border-blue-400 rounded-xl">
                    <div class="flex items-center gap-3 mb-4">
                        <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h4 class="text-xl font-bold text-blue-800">OCR Processing Complete</h4>
                    </div>
                    <div class="bg-white p-4 rounded-lg space-y-2 text-gray-800">
                        <p><strong>Extracted Text:</strong></p>
                        <p class="whitespace-pre-wrap border-l-4 border-blue-300 pl-4 py-2">${extractedText || 'No text extracted'}</p>
                    </div>
                </div>
            `;
        }
    }
    // Symptoms Checker - handle response with status success and result
    else if (currentWorkflow === 'symptoms-checker') {
        let analysisText = '';
        
        if (response.status === 'success' && response.result) {
            analysisText = response.result;
        } else if (response.result) {
            analysisText = response.result;
        } else if (response.analysis) {
            analysisText = response.analysis;
        }
        
        content.innerHTML = `
            <div class="success-alert p-6 bg-purple-50 border-2 border-purple-400 rounded-xl">
                <div class="flex items-center gap-3 mb-4">
                    <svg class="w-7 h-7 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h4 class="text-xl font-bold text-purple-800">Symptom Analysis Complete</h4>
                </div>
                <div class="bg-white p-4 rounded-lg text-gray-800">
                    <p class="whitespace-pre-wrap leading-relaxed">${analysisText || 'Analysis not available'}</p>
                </div>
            </div>
        `;
    }
    // Patient Follow-Up - handle workflow start message
    else if (currentWorkflow === 'patient-followup') {
        if (response.message) {
            content.innerHTML = `
                <div class="success-alert p-6 bg-teal-50 border-2 border-teal-400 rounded-xl">
                    <div class="flex items-center gap-3 mb-4">
                        <svg class="w-7 h-7 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h4 class="text-xl font-bold text-teal-800">Follow-Up Message Sent</h4>
                    </div>
                    <div class="bg-white p-4 rounded-lg text-gray-800">
                        <p class="leading-relaxed">${response.message}</p>
                        <p class="text-sm text-gray-600 mt-3">üì± The patient will receive your follow-up message shortly.</p>
                    </div>
                </div>
            `;
        }
    }
    // Other workflows that return a summary
    else if (response && response.summary) {
        content.innerHTML = `<div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">${response.summary}</div>`;
    }
    // Default: show raw JSON for debugging or other workflows
    else {
        content.innerHTML = `<pre class="text-sm whitespace-pre-wrap">${JSON.stringify(response, null, 2)}</pre>`;
    }
    
    container.classList.remove('hidden');
}

function showError(message) {
    const container = document.getElementById('error-container');
    container.textContent = `Error: ${message}`;
    container.classList.remove('hidden');
}

function hideMessages() {
    document.getElementById('response-container').classList.add('hidden');
    document.getElementById('error-container').classList.add('hidden');
}

// ============================================
// PROFESSIONAL CHATBOT FUNCTIONS
// ============================================

const CHAT_TABS = [
    { id: 'appointment', label: 'Appointments', icon: 'üìÖ', desc: 'Book or manage' },
    { id: 'contact', label: 'Contact Info', icon: 'üìû', desc: 'Get in touch' },
    { id: 'location', label: 'Location', icon: 'üìç', desc: 'Find us' },
    { id: 'insurance', label: 'Insurance', icon: 'üõ°Ô∏è', desc: 'Accepted plans' },
    { id: 'pricing', label: 'Pricing', icon: 'üí∞', desc: 'Service costs' },
    { id: 'emergency', label: 'Emergency', icon: 'üö®', desc: '24/7 care' },
    { id: 'chat with agent', label: 'Live Chat', icon: 'üí¨', desc: 'Talk to agent', isLive: true }
];

function toggleChat() {
    const chatWindow = document.getElementById('chatbot-window');
    const toggleBtn = document.getElementById('chat-toggle-btn');
    
    if (chatWindow.classList.contains('hidden')) {
        chatWindow.classList.remove('hidden');
        toggleBtn.style.display = 'none';
        if (chatMode === 'menu' || chatMode === 'closed') {
            resetChat();
        }
    } else {
        chatWindow.classList.add('hidden');
        toggleBtn.style.display = 'flex';
    }
}

function resetChat() {
    chatMode = 'menu';
    sessionId = 'session-' + Date.now();
    renderChatContent();
    setInputEnabled(false);
    document.getElementById('back-to-menu').classList.add('hidden');
    updateStatus('Online 24/7', false);
}

function renderChatContent() {
    const container = document.getElementById('chat-messages');
    
    // Welcome message
    let html = `
        <div class="welcome-message">
            <div class="welcome-avatar">SC</div>
            <div class="welcome-bubble">
                <p>üëã Welcome to <strong>Healthcare Automation</strong>! I'm your virtual assistant, available 24/7 to help you.</p>
            </div>
        </div>
    `;
    
    // Menu tabs
    html += '<div class="menu-tabs">';
    CHAT_TABS.forEach(tab => {
        const fullWidthClass = tab.isLive ? 'full-width' : '';
        html += `
            <button class="menu-tab ${fullWidthClass}" onclick="selectTab('${tab.id}')">
                <span class="menu-tab-icon">${tab.icon}</span>
                <div class="menu-tab-content">
                    <p class="menu-tab-title">${tab.label}</p>
                    <p class="menu-tab-desc">${tab.desc}</p>
                </div>
            </button>
        `;
    });
    html += '</div>';
    
    container.innerHTML = html;
    scrollToBottom();
}

async function selectTab(tabId) {
    const tab = CHAT_TABS.find(t => t.id === tabId);
    if (!tab) return;
    
    chatMode = 'loading';
    
    // Add user message
    addUserMessage(tab.label);
    
    // Show typing indicator
    showTyping();
    
    try {
        const response = await sendToWebhook(tabId);
        
        // Remove typing indicator
        hideTyping();
        
        // Add bot response
        addBotMessage(response);
        
        if (tab.isLive) {
            chatMode = 'live-chat';
            setInputEnabled(true);
            document.getElementById('back-to-menu').classList.remove('hidden');
            updateStatus('Live Chat Active', true);
        } else {
            chatMode = 'response';
            showFollowUp();
        }
    } catch (error) {
        hideTyping();
        addBotMessage('Sorry, something went wrong. Please try again.');
        showFollowUp();
    }
}

async function sendToWebhook(message) {
    try {
        const response = await fetch(CHATBOT_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                message: message,
                session_id: sessionId
            })
        });
        
        if (!response.ok) throw new Error('Network error');
        
        const data = await response.json();
        return data.reply || data.message || data.response || 'Thank you for your message.';
    } catch (error) {
        console.error('Webhook error:', error);
        // Return mock response for demo
        return getMockResponse(message);
    }
}

function getMockResponse(tab) {
    const responses = {
        'appointment': '<strong>üìÖ Appointment Services</strong><br><br>To book an appointment, please provide:<br>‚Ä¢ Your full name<br>‚Ä¢ Preferred date and time<br>‚Ä¢ Department<br><br><strong>Working Hours:</strong><br>Monday - Friday: 9:00 AM - 5:00 PM<br>Saturday: 9:00 AM - 1:00 PM',
        'contact': '<strong>üìû Contact Information</strong><br><br><strong>Phone:</strong> +966-555-000000<br><strong>Email:</strong> info@smarthospital.com<br><strong>Website:</strong> HealthcareAutomationAgency.com<br><br><strong>Working Hours:</strong><br>Outpatient: 9 AM ‚Äì 5 PM<br>Emergency: 24/7',
        'location': '<strong>üìç Our Location</strong><br><br><strong>Hospital management system</strong><br>Riyadh, Saudi Arabia<br><br>We are located in the heart of Riyadh, easily accessible by public transport with ample parking available.',
        'insurance': '<strong>üõ°Ô∏è Accepted Insurance Plans</strong><br><br>We accept most major insurance providers:<br>‚Ä¢ Bupa Arabia<br>‚Ä¢ Tawuniya<br>‚Ä¢ Medgulf<br>‚Ä¢ SAICO<br>‚Ä¢ Malath Insurance<br>‚Ä¢ And many more<br><br>Please contact us to verify your coverage.',
        'pricing': '<strong>üí∞ Pricing Information</strong><br><br><strong>Consultation Fees:</strong><br>‚Ä¢ General: SAR 150-250<br>‚Ä¢ Specialist: SAR 300-500<br><br>Prices may vary based on insurance and services required.',
        'emergency': '<strong>üö® Emergency Services</strong><br><br><strong>Hotline:</strong> +966-555-000000<br><br>Our Emergency Department is open <strong>24/7</strong>.<br><br>If experiencing a medical emergency:<br>1. Call our hotline immediately<br>2. Or visit our Emergency Department',
        'chat with agent': '<strong>üí¨ Live Chat Activated</strong><br><br>Hello! I\'m here to help you with any questions about Hospital management system.<br><br>You can ask me about:<br>‚Ä¢ Appointments & scheduling<br>‚Ä¢ Our medical services<br>‚Ä¢ Insurance & billing<br><br>How can I assist you today?'
    };
    return responses[tab] || 'Thank you for your message. How can I assist you further?';
}

function addUserMessage(text) {
    const container = document.getElementById('chat-messages');
    const html = `
        <div class="message-row user">
            <div class="message-bubble user">${escapeHtml(text)}</div>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
    scrollToBottom();
}

function addBotMessage(text) {
    const container = document.getElementById('chat-messages');
    const html = `
        <div class="message-row bot">
            <div class="bot-avatar">SC</div>
            <div class="message-bubble bot">${text}</div>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
    scrollToBottom();
}

function showTyping() {
    const container = document.getElementById('chat-messages');
    const html = `
        <div class="typing-indicator" id="typing-indicator">
            <div class="bot-avatar">SC</div>
            <div class="typing-bubble">
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
            </div>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
    scrollToBottom();
}

function hideTyping() {
    const typing = document.getElementById('typing-indicator');
    if (typing) typing.remove();
}

function showFollowUp() {
    const container = document.getElementById('chat-messages');
    const html = `
        <div class="followup-container">
            <div class="followup-avatar">SC</div>
            <div class="followup-bubble">
                <p>Would you like help with anything else?</p>
                <div class="followup-buttons">
                    <button class="followup-btn yes" onclick="handleYes()">Yes, please</button>
                    <button class="followup-btn no" onclick="handleNo()">No, thanks</button>
                </div>
            </div>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
    scrollToBottom();
}

function handleYes() {
    showMenu();
}

function handleNo() {
    addBotMessage('Thank you for visiting Hospital management system. Wishing you good health! üíô');
    chatMode = 'closed';
    
    // Show restart button
    const container = document.getElementById('chat-messages');
    const html = `
        <div style="text-align: center; margin-top: 16px;">
            <button onclick="resetChat()" style="padding: 10px 24px; background: linear-gradient(135deg, #0066cc, #0088cc); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer;">
                Start New Conversation
            </button>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
    scrollToBottom();
}

function showMenu() {
    chatMode = 'menu';
    setInputEnabled(false);
    document.getElementById('back-to-menu').classList.add('hidden');
    updateStatus('Online 24/7', false);
    
    // Add menu after current messages
    const container = document.getElementById('chat-messages');
    let html = '<div class="menu-tabs" style="margin-top: 16px;">';
    CHAT_TABS.forEach(tab => {
        const fullWidthClass = tab.isLive ? 'full-width' : '';
        html += `
            <button class="menu-tab ${fullWidthClass}" onclick="selectTab('${tab.id}')">
                <span class="menu-tab-icon">${tab.icon}</span>
                <div class="menu-tab-content">
                    <p class="menu-tab-title">${tab.label}</p>
                    <p class="menu-tab-desc">${tab.desc}</p>
                </div>
            </button>
        `;
    });
    html += '</div>';
    container.insertAdjacentHTML('beforeend', html);
    scrollToBottom();
}

async function sendChatMessage() {
    const input = document.getElementById('chat-input');
    const message = input.value.trim();
    if (!message || chatMode !== 'live-chat') return;
    
    input.value = '';
    addUserMessage(message);
    showTyping();
    
    try {
        const response = await sendToWebhook(message);
        hideTyping();
        addBotMessage(response);
    } catch (error) {
        hideTyping();
        addBotMessage('Sorry, I couldn\'t process your message. Please try again.');
    }
}

function setInputEnabled(enabled) {
    const input = document.getElementById('chat-input');
    const btn = document.getElementById('chat-send-btn');
    input.disabled = !enabled;
    btn.disabled = !enabled;
    input.placeholder = enabled ? 'Type your message...' : 'Select an option above...';
}

function updateStatus(text, isLive) {
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');
    statusText.textContent = text;
    statusDot.style.background = isLive ? '#4ade80' : '#4ade80';
}

function scrollToBottom() {
    const container = document.getElementById('chat-messages');
    setTimeout(() => {
        container.scrollTop = container.scrollHeight;
    }, 50);
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Initialize chat on page load
document.addEventListener('DOMContentLoaded', function() {
    renderChatContent();
});
</script>
</body>
</html>
